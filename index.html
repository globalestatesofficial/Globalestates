<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Estates</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#f1f5f9;
}

header{
  background:#0f172a;
  color:white;
  padding:15px;
  font-size:22px;
  font-weight:bold;
  text-align:center;
}

.container{
  padding:15px;
}

input,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

button{
  background:#2563eb;
  color:white;
  border:none;
  font-weight:bold;
}

.search{
  background:white;
  padding:12px;
  border-radius:12px;
  margin-bottom:15px;
  box-shadow:0 3px 10px rgba(0,0,0,0.08);
}

.card{
  background:white;
  padding:15px;
  border-radius:12px;
  margin-top:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.price{
  color:green;
  font-weight:bold;
  font-size:18px;
}

.whatsapp{
  background:#25D366;
  margin-top:10px;
}

.logout{
  background:red;
  margin-bottom:10px;
}
</style>
</head>

<body>

<header>üè† Global Estates</header>

<!-- LOGIN -->
<div class="container" id="authBox">
  <h3>Login / Register</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="signup()">Register</button>
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div class="container" id="app" style="display:none">

  <button class="logout" onclick="logout()">Logout</button>

  <div class="search">
    <h3>Post Property</h3>
    <input id="title" placeholder="Property title">
    <input id="price" placeholder="Price">
    <input id="whatsapp" placeholder="WhatsApp number">
    <button onclick="addProperty()">Post Property</button>
  </div>

  <div class="search">
    <input id="searchBox" placeholder="Search property..." onkeyup="searchProperty()">
  </div>

  <h3>Latest Properties</h3>
  <div id="list"></div>

</div>

<script>
// SUPABASE
const supabase = window.supabase.createClient(
"https://okfejpqxwhykjixczwht.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9rZmVqcHF4d2h5a2ppeGN6d2h0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MTcxMjksImV4cCI6MjA4NjI5MzEyOX0.lz5_XWrBHnzk4VP1vtHQwYLCd5gd6oHgGxiKo0JxMps"
);

// REGISTER
async function signup(){
  const email=emailEl().value;
  const password=passEl().value;

  const {error}=await supabase.auth.signUp({email,password});
  if(error) alert(error.message);
  else alert("Registered! Now login");
}

// LOGIN
async function login(){
  const email=emailEl().value;
  const password=passEl().value;

  const {error}=await supabase.auth.signInWithPassword({email,password});
  if(error) alert(error.message);
  else checkUser();
}

// LOGOUT
async function logout(){
  await supabase.auth.signOut();
  location.reload();
}

// CHECK USER
async function checkUser(){
  const {data:{user}}=await supabase.auth.getUser();
  if(user){
    authBox.style.display="none";
    app.style.display="block";
    loadProperties();
  }
}
checkUser();

// ADD PROPERTY
async function addProperty(){
  const {data:{user}}=await supabase.auth.getUser();

  const title=val("title");
  const price=val("price");
  const whatsapp=val("whatsapp");

  if(!title || !price || !whatsapp){
    alert("Fill all fields");
    return;
  }

  const {error}=await supabase.from("properties").insert([{
    title:title,
    price:price,
    whatsapp:whatsapp,
    user_id:user.id
  }]);

  if(error){
    alert(error.message);
    return;
  }

  alert("Property Posted");
  clearInputs();
  loadProperties();
}

// LOAD PROPERTIES
let allData=[];

async function loadProperties(){
  const {data,error}=await supabase
  .from("properties")
  .select("*")
  .order("id",{ascending:false});

  if(error){
    alert(error.message);
    return;
  }

  allData=data;
  showData(data);
}

// SHOW DATA
function showData(data){
  const list=document.getElementById("list");
  list.innerHTML="";

  data.forEach(p=>{
    list.innerHTML+=`
    <div class="card">
      <h3>${p.title}</h3>
      <div class="price">‚Çπ ${p.price}</div>
      <a href="https://wa.me/${p.whatsapp}">
        <button class="whatsapp">WhatsApp</button>
      </a>
    </div>`;
  });
}

// SEARCH
function searchProperty(){
  const text=document.getElementById("searchBox").value.toLowerCase();
  const filtered=allData.filter(p=>p.title.toLowerCase().includes(text));
  showData(filtered);
}

// HELPERS
function val(id){return document.getElementById(id).value;}
function emailEl(){return document.getElementById("email");}
function passEl(){return document.getElementById("password");}
function clearInputs(){
  document.getElementById("title").value="";
  document.getElementById("price").value="";
  document.getElementById("whatsapp").value="";
}
</script>

</body>
</html>
