<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Estates</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
font-family:Poppins;
margin:0;
background:#0f172a;
color:white;
}
header{
background:#020617;
padding:15px;
font-size:22px;
font-weight:700;
text-align:center;
color:#38bdf8;
}
.container{padding:20px;max-width:900px;margin:auto;}
input,button,select{
width:100%;
padding:12px;
margin:8px 0;
border-radius:8px;
border:none;
font-size:16px;
}
button{
background:#38bdf8;
color:black;
font-weight:600;
cursor:pointer;
}
.card{
background:#020617;
padding:15px;
border-radius:12px;
margin-top:15px;
box-shadow:0 0 10px rgba(0,0,0,0.5);
}
.whatsapp{
background:#22c55e;
color:white;
margin-top:10px;
}
.google{
background:white;
color:black;
}
.hidden{display:none;}
</style>
</head>

<body>

<header>üè† Global Estates</header>

<div class="container">

<!-- LOGIN -->
<div id="authBox">
<h2>Login / Signup</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">

<button onclick="signup()">Signup</button>
<button onclick="login()">Login</button>
<button class="google" onclick="googleLogin()">Login with Google</button>
</div>

<!-- POST PROPERTY -->
<div id="postBox" class="hidden">
<h2>Post Property (Agents)</h2>

<input id="title" placeholder="Property title">
<input id="price" placeholder="Price">
<input id="location" placeholder="Location">
<input id="whatsapp" placeholder="WhatsApp number with country code">

<button onclick="postProperty()">Post Property</button>
<button onclick="logout()">Logout</button>
</div>

<!-- LISTINGS -->
<h2 style="margin-top:30px">Latest Properties</h2>
<div id="listings"></div>

</div>

<script>
// SUPABASE CONFIG (your keys added)
const supabase = window.supabase.createClient(
"https://okfejpqxwhykjixczwht.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9rZmVqcHF4d2h5a2ppeGN6d2h0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MTcxMjksImV4cCI6MjA4NjI5MzEyOX0.lz5_XWrBHnzk4VP1vtHQwYLCd5gd6oHgGxiKo0JxMps"
);

// SIGNUP
async function signup(){
let email=document.getElementById("email").value;
let password=document.getElementById("password").value;

const {error}=await supabase.auth.signUp({email,password});
if(error) alert(error.message);
else alert("Signup success. Now login.");
}

// LOGIN
async function login(){
let email=document.getElementById("email").value;
let password=document.getElementById("password").value;

const {error}=await supabase.auth.signInWithPassword({email,password});
if(error) alert(error.message);
else{
alert("Login success");
checkUser();
}
}

// GOOGLE LOGIN
async function googleLogin(){
await supabase.auth.signInWithOAuth({
provider:'google',
options:{redirectTo:window.location.origin}
});
}

// LOGOUT
async function logout(){
await supabase.auth.signOut();
location.reload();
}

// CHECK USER
async function checkUser(){
const {data:{user}}=await supabase.auth.getUser();
if(user){
document.getElementById("authBox").classList.add("hidden");
document.getElementById("postBox").classList.remove("hidden");
loadProperties();
}else{
loadProperties();
}
}
checkUser();

// POST PROPERTY
async function postProperty(){
let title=document.getElementById("title").value;
let price=document.getElementById("price").value;
let location=document.getElementById("location").value;
let whatsapp=document.getElementById("whatsapp").value;

const {error}=await supabase.from("properties").insert([
{title,price,location,whatsapp}
]);

if(error){alert(error.message);}
else{
alert("Property posted");
loadProperties();
}
}

// LOAD
async function loadProperties(){
const {data,error}=await supabase.from("properties").select("*").order("id",{ascending:false});
if(data){
let html="";
data.forEach(p=>{
html+=`
<div class="card">
<h3>${p.title}</h3>
<p>üí∞ ${p.price}</p>
<p>üìç ${p.location}</p>
<a href="https://wa.me/${p.whatsapp}" target="_blank">
<button class="whatsapp">WhatsApp Agent</button>
</a>
</div>
`;
});
document.getElementById("listings").innerHTML=html;
}
}
</script>

</body>
</html>
